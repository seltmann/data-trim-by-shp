---
title: "filter_polygon"
author: "JT_Miller"
date: "6/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# started by Katja Seltmann, 2020
# Script to map occurrence records of species (lat/long) that occur only within the boundaries of Coal Oil Point Reserve (shp file)
# COPR occurrence records in tab-delimited format: https://ucsb.box.com/s/7xp88xhg1xn7decsv0t3ll8du653deub
# COPR boundary files: https://ucsb.box.com/s/nd1s0e3ted8zsu0ir4wbxu7qpe94ht8o

#The goal of this script is to:
#draw boundary of copr on map
#Trim specimen_data (occurrence.txt) based on copr boundary creating new file that only contains specimens whose coordinates are within that boundary

```{r}
#required libraries
library(ggplot2)
library(maptools)
library(sf)
library(maps)
library(raster)
library(rgdal)

```


```{r}
#file that contains over 75K of specimen data with lat/long coordinates
specimen_data <- read.delim(file="occurrence.txt",header=TRUE)
```


```{r}
#print data dimensions
dim(specimen_data)

names(specimen_data)

```

```{r}
#remove rows where lat/long do not exist
specimen_data <- subset(specimen_data, !is.na(order) & !is.na(decimalLongitude) & !is.na(decimalLatitude))


```


```{r}
#print data dimensions
dim(specimen_data)


```


```{r}
#remove columns and rows for smaller test dataset that only includes long and lat, and limit to only 100 rows for testing

#column decimalLongitude = 134
#column decimalLatitude = 133

specimen_data_less <-specimen_data[1:100,c(134,133)]
head(specimen_data_less)

```


```{r}
#print dimensions of new dataset
dim(specimen_data_less)

```

```{r}
#read boundary from shp file
copr_boundary_2020 <- st_read("COPR_Boundary_2010/COPR_boundary2010.shp")

#What is the projection of copr_boundary_2020

crs(copr_boundary_2020) #Projection is lcc...not sure what this is: https://en.wikipedia.org/wiki/Lambert_conformal_conic_projection 

extent(copr_boundary_2020) #so this is in lat long, but not decimal formatting (degrees)
```


```{r}
#draw boundary from shp file
ggplot() +
  geom_sf(data = copr_boundary_2020, fill = "palegreen", color = "black")
```



```{r}
#graph boundary and points
ggplot(data = copr_boundary_2020) +
  geom_point(data = specimen_data_less, aes(x = decimalLongitude, y = decimalLatitude), shape = 1)

ggplot(data = copr_boundary_2020) +
  geom_point(data = specimen_data_less2, aes(x = decimalLongitude, y = decimalLatitude), shape = 1)

```



```{r}
#Lets try to figure out what the specimen data is 

str(specimen_data)

names(specimen_data_less)

head(specimen_data_less)

spec_CRS <- st_crs(specimen_data_less)

crs(spec_CRS) #NA...not what we want. 

specimen_data_less_longlat_crs <- specimen_data_less

#We can't access a cRS for the specimen data...

#Perhaps we need to assign a Rasterlayer to this? 
#crs(specimen_data_less_longlat_crs) <- "+proj=lcc +lat_1=35.46666666666667 +lat_2=34.03333333333333 +lat_0=33.5 +lon_0=-118 +x_0=2000000.0001016 +y_0=500000.0001016001 +ellps=GRS80 +datum=NAD83 +to_meter=0.3048006096012192 +no_defs"
#Not confident that these are the correct parameters, gotta double check this 


```
```{r}
#Conversion from a txt file to a shapefile?

names(specimen_data_less)

head(specimen_data_less)

#Locating the same area using the CRS from the boundary data...not sure if this is the correct method.
#https://www.spatialreference.org/ref/epsg/2229/proj4/ 


latlong_crs <- st_crs(specimen_data_less)

latlong_crs #Returns NA...

boundary_crs <- st_crs(copr_boundary_2020)
boundary_crs #Returns a valid CRS

#Maybe try using this CRS to conform?

specimen_data_less_bounded <- st_as_sf(specimen_data_less, coords = c("decimalLongitude", "decimalLatitude"), 
                                       crs = boundary_crs)



```

```{r}
#Specimen Locations 

ggplot() +
  #geom_sf(data = copr_boundary_2020) +
  geom_sf(data=specimen_data_less_bounded) +
  ggtitle("Map of Specimen Locations")
```

```{r}
#Lets try cropping?

Specimen_data_cropped <- crop(x=specimen_data_less_bounded, y = copr_boundary_2020) #Cropping definitely does not work. 

```




```{r}
#combine the two? This does not work!!! Have fun JT!!
ggplot() +
  geom_sf(data = copr_boundary_2020, fill = "palegreen", color = "black") +
  geom_point(data = specimen_data_less, aes(x = decimalLongitude, y = decimalLatitude), shape = 1)
  
```













```{r}
#combine the two? This does not work!!! Have fun JT!!

#So the problem seems to be that we are looking at 2 different types of lat/long coordinates. One is in degrees and the other in full integers. We need to convert one to the other in order for the points to show up on the graph. 

#specimen_data_less_df <- as.data.frame(specimen_data_less, xy = TRUE) #Worth a shot
ggplot() +
   geom_sf(data = specimen_data_less_bounded) +
  geom_sf(data = copr_boundary_2020, fill = "palegreen", color = "black") 
  
```

  



     

  




  



