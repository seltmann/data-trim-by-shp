---
title: "filter_polygon"
author: "JT_Miller"
date: "6/22/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# started by Katja Seltmann, 2020
# Script to map occurrence records of species (lat/long) that occur only within the boundaries of Coal Oil Point Reserve (shp file)
# COPR occurrence records in tab-delimited format: https://ucsb.box.com/s/7xp88xhg1xn7decsv0t3ll8du653deub
# COPR boundary files: https://ucsb.box.com/s/nd1s0e3ted8zsu0ir4wbxu7qpe94ht8o

#The goal of this script is to:
#draw boundary of copr on map
#Trim specimen_data (occurrence.txt) based on copr boundary creating new file that only contains specimens whose coordinates are within that boundary

```{r}
#required libraries
library(ggplot2)
library(maptools)
library(sf)
library(maps)
library(raster)
library(rgdal)

```


```{r}
#file that contains over 75K of specimen data with lat/long coordinates
specimen_data <- read.delim(file="occurrence.txt",header=TRUE)
```


```{r}
#print data dimensions
dim(specimen_data)

names(specimen_data)

```

```{r}
#remove rows where lat/long do not exist
specimen_data <- subset(specimen_data, !is.na(order) & !is.na(decimalLongitude) & !is.na(decimalLatitude))


```


```{r}
#print data dimensions
dim(specimen_data)


```


```{r}
#remove columns and rows for smaller test dataset that only includes long and lat, and limit to only 100 rows for testing

#column decimalLongitude = 134
#column decimalLatitude = 133

specimen_data_less <-specimen_data[1:100,c(134,133)]
head(specimen_data_less)

```


```{r}
#print dimensions of new dataset
dim(specimen_data_less)

```

```{r}
#read boundary from shp file
copr_boundary_2020 <- st_read("COPR_Boundary_2010/COPR_boundary2010.shp")

copr_boundary_2020
#What is the projection of copr_boundary_2020

crs(copr_boundary_2020) #Projection is lcc...not sure what this is: https://en.wikipedia.org/wiki/Lambert_conformal_conic_projection 


extent(copr_boundary_2020) #so this is in lat long, but not decimal formatting (degrees)

head(copr_boundary_2020)
```


```{r}
#draw boundary from shp file
ggplot() +
  geom_sf(data = copr_boundary_2020, fill = "palegreen", color = "black")


```



```{r}
#graph boundary and points
ggplot(data = copr_boundary_2020) +
  geom_point(data = specimen_data_less, aes(x = decimalLongitude, y = decimalLatitude), shape = 1)



```







```{r}
#Lets try cropping?

Specimen_data_cropped <- crop(x=specimen_data_less_bounded, y = copr_boundary_2020) #Cropping definitely does not work. 

```




```{r}
#combine the two? This does not work!!! Have fun JT!!
ggplot() +
  geom_sf(data = copr_boundary_2020, fill = "palegreen", color = "black") +
  geom_point(data = specimen_data_less, aes(x = decimalLongitude, y = decimalLatitude), shape = 1)
  
```
```{r}
#Making df to try and plot
copr_boundary_2020_df <- as.data.frame(copr_boundary_2020, xy=TRUE)

specimen_data_less_df <- as.data.frame(specimen_data_less, xy=TRUE)
```

```{r}
#combine the two? This does not work!!! Have fun JT!!
ggplot() + 
  geom_sf(data = copr_boundary_2020, fill = "palegreen", color = "black") + 
  geom_point(data = specimen_data_less, mapping = aes(x = decimalLongitude, y = decimalLatitude), colour = "red") 
  
```
```{r}
ggplot() +
  geom_point(data = specimen_data_less_df, aes(x=decimalLongitude, y = decimalLatitude), shape = 1) +
  coord_quickmap() + 
 geom_sf(data = copr_boundary_2020_df, aes(geometry = geometry), fill = "palegreen", color = "black")
```


```{r}
ggplot(copr_boundary_2020, aes(x=x, y=y)) +
  geom_polygon(fill = "green", colour = "grey50") +
  coord_quickmap()
```









```{r}
#combine the two? This does not work!!! Have fun JT!!

#So the problem seems to be that we are looking at 2 different types of lat/long coordinates. One is in degrees and the other in full integers. We need to convert one to the other in order for the points to show up on the graph. 

#specimen_data_less_df <- as.data.frame(specimen_data_less, xy = TRUE) #Worth a shot
ggplot() +
   geom_sf(data = specimen_data_less_bounded) +
  geom_sf(data = copr_boundary_2020, fill = "palegreen", color = "black") 
  
```

  



     

  




  



